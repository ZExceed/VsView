(function(c){var b=function(h){this.options=c.extend({borderColor:"000000",drawRect:true},h);var f=c(this.options.container),g=c("<canvas/>")[0];f.css("position","relative");this.canvas=g;this.container=f;this.context=g.getContext("2d");this._rect={top:null,right:null,bottom:null,left:null};this.callback=null;this.init();};b.prototype.init=function(){var f=this,g=new Image();if(!this.options.image){return;}g.onload=function(){f.load(g);};g.src=this.options.image;};b.prototype.load=function(g){var f=this;f.canvas.width=g.width;f.canvas.height=g.height;f.context.drawImage(g,0,0);f.container.append(f.canvas).on("click",function(i){if(c(i.target).is("div.rect")){return false;}var h=f.rect(i.offsetX,i.offsetY);f.callback&&f.callback(h,f.draw(h));});};b.prototype.rect=function(g,i){this._rect={top:null,right:null,bottom:null,left:null};this.scan("top",g,i);this.scan("right",g,i);this.scan("bottom",g,i);this.scan("left",g,i);if(a(this._rect,null)){do{var h=this._rect;if(a(h,0)){var f={x:h.left[0],y:h.top[1],w:h.right[0]-h.left[0],h:h.bottom[1]-h.top[1]};return a(f,0)?f:null;}else{return null;}}while(!a(this._rect,null));}};b.prototype.scan=function(i,f,j){var g=this.context.getImageData(f,j,1,1).data,h=[g[0],g[1],g[2]].toString();if(h==="0,0,0"&&g[3]===0){this._rect[i]=0;}else{if(h===e(this.options.borderColor).toString()){this._rect[i]=[f,j];}else{i==="top"&&j--;i==="right"&&f++;i==="bottom"&&j++;i==="left"&&f--;this.scan(i,f,j);}}};b.prototype.active=function(f){this.callback=d(f)?f:null;};b.prototype.draw=function(g){if(!this.options.drawRect||!a(g,0)){return;}var f=c('<div class="rect" />').css({position:"absolute","z-index":9,top:g.y,left:g.x,width:g.w-1,height:g.h-1,border:"1px solid rgba(0, 255, 0, 0.7)",background:"rgba(0, 255, 100, 0.25)"});f.appendTo(this.container);return f;};var e=function(f){var g=parseInt(f,16);return[g>>16,g>>8&255,g&255];};var a=function(g,h){if(!g){return false;}for(var f in g){if(g.hasOwnProperty(f)&&g[f]===h){return false;}}return true;};var d=function(g){var f=Object.prototype.toString.call(g).slice(8,-1);return g!==undefined&&g!==null&&f==="Function";};c.fn.VsView=function(g){var f=c.extend({container:this},g);return new b(f);};}(jQuery));